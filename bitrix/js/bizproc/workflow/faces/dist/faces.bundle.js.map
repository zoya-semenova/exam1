{"version":3,"file":"faces.bundle.js","sources":["../src/components/column.js","../src/components/column-author.js","../src/components/column-done.js","../src/components/column-running.js","../src/components/column-completed.js","../src/components/summary.js","../src/components/application.js","../src/faces.js"],"sourcesContent":["import { DateTimeFormat } from 'main.date';\nimport { Type, Text } from 'main.core';\nimport 'ui.tooltip';\n\nimport '../css/column.css';\n\nexport const Column = {\n\tname: 'bp-workflow-faces-column',\n\tprops: {\n\t\ttitle: String,\n\t\tavatars: Array,\n\t\tstatus: {\n\t\t\ttype: String,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn ['accept', 'decline', 'progress'].includes(value);\n\t\t\t},\n\t\t},\n\t\thasMoreTasks: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\ttasksCount: Number,\n\t\ttime: Number,\n\t},\n\tcomputed: {\n\t\thasTitle(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.title);\n\t\t},\n\t\thasFaces(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.avatars);\n\t\t},\n\t\thasStatus(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.status);\n\t\t},\n\t\thasTime(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.time);\n\t\t},\n\t\tisProgressStatus(): boolean\n\t\t{\n\t\t\treturn this.status === 'progress';\n\t\t},\n\t\tisAcceptStatus(): boolean\n\t\t{\n\t\t\treturn this.status === 'accept';\n\t\t},\n\t\tisDeclineStatus(): boolean\n\t\t{\n\t\t\treturn this.status === 'decline';\n\t\t},\n\t\tduration(): string\n\t\t{\n\t\t\tif (Type.isNil(this.time) || this.time === 0)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_EMPTY_TIME');\n\t\t\t}\n\n\t\t\treturn DateTimeFormat.format(\n\t\t\t\t[['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff']],\n\t\t\t\t0,\n\t\t\t\tthis.time,\n\t\t\t);\n\t\t},\n\t\tcompletedTasksCountMessage(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BIZPROC_JS_WORKFLOW_COMPLETED_TASK_COUNT', { '#COUNT#': this.tasksCount });\n\t\t},\n\t},\n\tmethods: {\n\t\tgetSafeUrl(url): string\n\t\t{\n\t\t\treturn `url('${encodeURI(Text.encode(url))}')`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"{\n\t\t\t\t'bp-workflow-faces__steps-item': true,\n\t\t\t\t'--in-progress': hasFaces,\n\t\t\t\t'--loading': !hasFaces && hasStatus,\n\t\t\t}\">\n\t\t\t<div\n\t\t\t\tv-if=\"hasMoreTasks\"\n\t\t\t\t:title=\"completedTasksCountMessage\"\n\t\t\t\tclass=\"bp-workflow-faces__icon-progress-box\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --more bp-workflow-faces__icon-progress\"></div>\n\t\t\t\t<div class=\"bp-workflow-faces__icon-progress-overlay\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bp-workflow-faces__steps-name\">\n\t\t\t\t<div v-if=\"hasTitle\" class=\"bp-workflow-faces__text-area\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"bp-workflow-faces__fake-area\">\n\t\t\t\t\t<div class=\"bp-workflow-faces__fake-area-stub\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bp-workflow-faces__steps-users\">\n\t\t\t\t<div v-if=\"!hasFaces && !hasStatus\" class=\"ui-icon-set --person bp-workflow-faces__steps-user\"></div>\n\t\t\t\t<template v-else-if=\"hasFaces\">\n\t\t\t\t\t<template v-if=\"hasStatus\">\n\t\t\t\t\t\t<div v-if=\"isProgressStatus\" class=\"bp-workflow-faces__icon-waiting-box\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --black-clock bp-workflow-faces__icon-waiting\"></div>\n\t\t\t\t\t\t\t<div class=\"bp-workflow-faces__icon-overlay\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isAcceptStatus\" class=\"bp-workflow-faces__icon-done-box\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --circle-check bp-workflow-faces__icon-done\"></div>\n\t\t\t\t\t\t\t<div class=\"bp-workflow-faces__icon-overlay\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isDeclineStatus\" class=\"bp-workflow-faces__icon-decline-box\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --cross-circle-60 bp-workflow-faces__icon-decline\"></div>\n\t\t\t\t\t\t\t<div class=\"bp-workflow-faces__icon-overlay\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-for=\"avatar in avatars\" :key=\"avatar.id\">\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tv-if=\"avatar.avatarUrl\"\n\t\t\t\t\t\t\tclass=\"bp-workflow-faces__steps-user-item\"\n\t\t\t\t\t\t\t:style=\"{ backgroundImage: getSafeUrl(avatar.avatarUrl)}\"\n\t\t\t\t\t\t\t:bx-tooltip-user-id=\"avatar.id\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else-if=\"avatar.id > 0\"\n\t\t\t\t\t\t\tclass=\"bp-workflow-faces__steps-user-item\"\n\t\t\t\t\t\t\t:bx-tooltip-user-id=\"avatar.id\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div v-else class=\"bp-workflow-faces__steps-user-item --tech\"></div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-if=\"isProgressStatus\" class=\"bp-workflow-faces__icon-waiting-box --center\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --black-clock bp-workflow-faces__icon-waiting\"></div>\n\t\t\t\t\t\t<div class=\"bp-workflow-faces__icon-overlay\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isAcceptStatus\" class=\"bp-workflow-faces__icon-done-box --center\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --circle-check bp-workflow-faces__icon-done\"></div>\n\t\t\t\t\t\t<div class=\"bp-workflow-faces__icon-overlay\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div class=\"bp-workflow-faces__steps-duration\">\n\t\t\t\t<div v-if=\"hasTime\" class=\"bp-workflow-faces__text-area\">\n\t\t\t\t\t{{ duration }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"bp-workflow-faces__fake-area\">\n\t\t\t\t\t<div class=\"bp-workflow-faces__fake-area-stub\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Column } from './column';\n\nexport const ColumnAuthor = {\n\tname: 'bp-workflow-faces-column-author',\n\tcomponents: {\n\t\tColumn,\n\t},\n\tprops: {\n\t\tavatars: Array,\n\t\ttime: Number,\n\t\thasMoreTasks: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\ttasksCount: Number,\n\t},\n\tcomputed: {\n\t\thasAvatars(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.avatars);\n\t\t},\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Column\n\t\t\t:title=\"loc('BIZPROC_JS_WORKFLOW_FACES_COLUMN_AUTHOR')\"\n\t\t\t:avatars=\"hasAvatars ? avatars : null\"\n\t\t\t:has-more-tasks=\"hasMoreTasks\"\n\t\t\t:tasks-count=\"tasksCount\"\n\t\t\t:time=\"time\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Column } from './column';\n\nexport const ColumnDone = {\n\tname: 'bp-workflow-faces-column-done',\n\tcomponents: {\n\t\tColumn,\n\t},\n\tprops: {\n\t\tavatars: Array,\n\t\ttime: Number,\n\t\tsuccessStatus: Boolean,\n\t},\n\tcomputed: {\n\t\thasAvatars(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.avatars);\n\t\t},\n\t\tstatus(): string\n\t\t{\n\t\t\treturn this.hasAvatars ? (this.successStatus ? 'accept' : 'decline') : 'accept';\n\t\t},\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Column\n\t\t\t:title=\"loc('BIZPROC_JS_WORKFLOW_FACES_COLUMN_DONE')\"\n\t\t\t:avatars=\"hasAvatars ? avatars : null\"\n\t\t\t:status=\"status\"\n\t\t\t:time=\"time\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Column } from './column';\n\nconst TIMER_UP_BOUNDARY: number = 60 * 60; // 1 hour\n\nexport const ColumnRunning = {\n\tname: 'bp-workflow-faces-column-running',\n\tcomponents: {\n\t\tColumn,\n\t},\n\tprops: {\n\t\tavatars: Array,\n\t\ttime: Number,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttimer: null,\n\t\t\tcomputedTime: 0,\n\t\t\tstartTime: Math.floor(Date.now() / 1000),\n\t\t};\n\t},\n\tcomputed: {\n\t\thasAvatars(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.avatars);\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.startTimer();\n\t},\n\tunmounted()\n\t{\n\t\tthis.stopTimer();\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tstartTimer()\n\t\t{\n\t\t\tthis.timer = setInterval(() => {\n\t\t\t\tif (this.time + this.computedTime < TIMER_UP_BOUNDARY)\n\t\t\t\t{\n\t\t\t\t\tthis.computedTime = Math.floor(Date.now() / 1000) - this.startTime;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.stopTimer();\n\t\t\t}, 1000);\n\t\t},\n\t\tstopTimer()\n\t\t{\n\t\t\tif (this.timer)\n\t\t\t{\n\t\t\t\tclearInterval(this.timer);\n\t\t\t\tthis.timer = null;\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Column\n\t\t\t:title=\"loc('BIZPROC_JS_WORKFLOW_FACES_COLUMN_RUNNING')\"\n\t\t\t:avatars=\"hasAvatars ? avatars : null\"\n\t\t\t:status=\"'progress'\"\n\t\t\t:time=\"time + computedTime\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Column } from './column';\n\nexport const ColumnCompleted = {\n\tname: 'bp-workflow-faces-column-completed',\n\tcomponents: {\n\t\tColumn,\n\t},\n\tprops: {\n\t\tavatars: Array,\n\t\ttime: Number,\n\t\tsuccessStatus: Boolean,\n\t},\n\tcomputed: {\n\t\thasAvatars(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.avatars);\n\t\t},\n\t\tstatus(): string\n\t\t{\n\t\t\treturn this.successStatus ? 'accept' : 'decline';\n\t\t},\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Column\n\t\t\t:title=\"loc('BIZPROC_JS_WORKFLOW_FACES_COLUMN_COMPLETED')\"\n\t\t\t:avatars=\"hasAvatars ? avatars : null\"\n\t\t\t:status=\"status\"\n\t\t\t:time=\"time\"\n\t\t/>\n\t`,\n};\n","import { Summary as FacesSummary } from 'bizproc.workflow.faces.summary';\nimport { Dom } from 'main.core';\n\nexport const Summary = {\n\tname: 'bp-workflow-faces-column-timeline',\n\tprops: {\n\t\tworkflowId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisFinalState: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\ttime: Number,\n\t\tshowArrow: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tshowContent: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.renderSummary();\n\t},\n\tupdated()\n\t{\n\t\tthis.renderSummary();\n\t},\n\tunmounted()\n\t{\n\t\tif (this.$refs.content)\n\t\t{\n\t\t\tDom.clean(this.$refs.content);\n\t\t}\n\t},\n\tmethods: {\n\t\trenderSummary()\n\t\t{\n\t\t\tif (this.$refs.content)\n\t\t\t{\n\t\t\t\tDom.clean(this.$refs.content);\n\t\t\t\tDom.append(\n\t\t\t\t\t(new FacesSummary({\n\t\t\t\t\t\tworkflowId: this.workflowId,\n\t\t\t\t\t\ttime: this.time,\n\t\t\t\t\t\tworkflowIsCompleted: this.isFinalState,\n\t\t\t\t\t\tshowArrow: this.showArrow,\n\t\t\t\t\t\tshowContent: this.showContent,\n\t\t\t\t\t})).render(),\n\t\t\t\t\tthis.$refs.content,\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bp-workflow-faces__steps-summary-item\" ref=\"content\"></div>\n\t`,\n};\n","import { Type, Text, ajax } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport { Column } from './column';\nimport { ColumnAuthor } from './column-author';\nimport { ColumnDone } from './column-done';\nimport { ColumnRunning } from './column-running';\nimport { ColumnCompleted } from './column-completed';\nimport { Summary } from './summary';\n\nimport '../css/application.css';\n\nconst timeValidator = (time) => {\n\treturn (Type.isNull(time) || time === 0 || Text.toInteger(time) > 0);\n};\n\nexport const Application = {\n\tname: 'bp-workflow-faces-application',\n\tcomponents: {\n\t\tColumn,\n\t\tColumnAuthor,\n\t\tColumnDone,\n\t\tColumnRunning,\n\t\tColumnCompleted,\n\t\tSummary,\n\t},\n\tprops: {\n\t\tavatars: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn (\n\t\t\t\t\tType.isArrayFilled(value.author)\n\t\t\t\t\t&& Type.isArray(value.running)\n\t\t\t\t\t&& Type.isArray(value.completed)\n\t\t\t\t\t&& Type.isArray(value.done)\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\tstatuses: {\n\t\t\ttype: Object,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn (\n\t\t\t\t\tType.isBoolean(value.completedSuccess)\n\t\t\t\t\t&& Type.isBoolean(value.doneSuccess)\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\ttime: {\n\t\t\ttype: Object,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn (\n\t\t\t\t\ttimeValidator(value.author)\n\t\t\t\t\t&& timeValidator(value.running)\n\t\t\t\t\t&& timeValidator(value.completed)\n\t\t\t\t\t&& timeValidator(value.done)\n\t\t\t\t\t&& timeValidator(value.total)\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\tinitialCompletedTaskCount: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\tworkflowIsCompleted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tworkflowId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn Type.isInteger(value) && value > 0;\n\t\t\t},\n\t\t},\n\t\ttaskId: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\tsummaryProps: {\n\t\t\ttype: Object,\n\t\t\tdefault: {\n\t\t\t\tshowArrow: true,\n\t\t\t\tshowContent: true,\n\t\t\t},\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tauthor: {\n\t\t\t\tavatars: this.avatars.author,\n\t\t\t\ttime: this.time.author,\n\t\t\t},\n\t\t\trunning: {\n\t\t\t\tavatars: this.avatars.running,\n\t\t\t\ttime: this.time.running,\n\t\t\t},\n\t\t\tcompleted: {\n\t\t\t\tavatars: this.avatars.completed,\n\t\t\t\tsuccessStatus: this.statuses.completedSuccess,\n\t\t\t\ttime: this.time.completed,\n\t\t\t},\n\t\t\tdone: {\n\t\t\t\tavatars: this.avatars.done,\n\t\t\t\tsuccessStatus: this.statuses.doneSuccess,\n\t\t\t\ttime: this.time.done,\n\t\t\t},\n\t\t\trunningTaskId: this.taskId,\n\t\t\tisFinalState: this.workflowIsCompleted,\n\t\t\tcompletedTaskCount: this.initialCompletedTaskCount,\n\t\t\thandleUpdateData: (event: BaseEvent) => {\n\t\t\t\tthis.updateData(event.getData());\n\t\t\t},\n\t\t\tunsubscribePushCallback: null,\n\t\t\tsummary: {\n\t\t\t\tworkflowId: this.workflowId,\n\t\t\t\ttime: this.time.total,\n\t\t\t\tisFinalState: this.workflowIsCompleted,\n\t\t\t\tshowArrow: Type.isBoolean(this.summaryProps.showArrow) ? this.summaryProps.showArrow : true,\n\t\t\t\tshowContent: Type.isBoolean(this.summaryProps.showContent) ? this.summaryProps.showContent : true,\n\t\t\t},\n\t\t\terrorMessage: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\tshowCompletedColumn(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.completed.avatars);\n\t\t},\n\t\thasMoreTaskIcon(): boolean\n\t\t{\n\t\t\treturn this.hiddenTasksCount > 0;\n\t\t},\n\t\thiddenTasksCount(): number\n\t\t{\n\t\t\tif (this.isFinalState)\n\t\t\t{\n\t\t\t\treturn this.completedTaskCount > 2 ? this.completedTaskCount - 2 : 0;\n\t\t\t}\n\n\t\t\treturn this.completedTaskCount > 1 ? this.completedTaskCount - 1 : 0;\n\t\t},\n\t\thasErrors(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.errorMessage);\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.subscribeOnEvents();\n\t},\n\tunmounted()\n\t{\n\t\tthis.unsubscribeOnEvents();\n\t},\n\tmethods: {\n\t\tsubscribeOnEvents()\n\t\t{\n\t\t\tif (!this.isFinalState)\n\t\t\t{\n\t\t\t\tif (BX.PULL)\n\t\t\t\t{\n\t\t\t\t\tthis.unsubscribePushCallback = BX.PULL.subscribe({\n\t\t\t\t\t\tmoduleId: 'bizproc',\n\t\t\t\t\t\tcommand: 'workflow',\n\t\t\t\t\t\tcallback: this.onPush.bind(this),\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.$root.$app)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.subscribe(this.$root.$app, 'Bizproc.WorkflowFaces.OnUpdateData', this.handleUpdateData);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tunsubscribeOnEvents()\n\t\t{\n\t\t\tif (Type.isFunction(this.unsubscribePushCallback))\n\t\t\t{\n\t\t\t\tthis.unsubscribePushCallback();\n\t\t\t\tthis.unsubscribePushCallback = null;\n\t\t\t}\n\n\t\t\tif (this.$root.$app)\n\t\t\t{\n\t\t\t\tEventEmitter.unsubscribe(this.$root.$app, 'Bizproc.WorkflowFaces.OnUpdateData', this.handleUpdateData);\n\t\t\t}\n\t\t},\n\t\tonPush(params)\n\t\t{\n\t\t\tif (params && params.eventName === 'UPDATED' && Type.isArrayFilled(params.items))\n\t\t\t{\n\t\t\t\tfor (const item of params.items)\n\t\t\t\t{\n\t\t\t\t\tif (String(item.id) === this.workflowId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.load();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tload()\n\t\t{\n\t\t\tif (this.$refs.container)\n\t\t\t{\n\t\t\t\tajax.runAction('bizproc.workflow.faces.load', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tworkflowId: this.workflowId,\n\t\t\t\t\t\trunningTaskId: this.runningTaskId,\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t},\n\t\t\t\t}).then(({ data }) => {\n\t\t\t\t\tthis.updateData(data);\n\t\t\t\t}).catch(({ errors }) => {\n\t\t\t\t\tif (Type.isArrayFilled(errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst firstError = errors.pop();\n\t\t\t\t\t\tif (firstError.code === 'ACCESS_DENIED')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.errorMessage = firstError.message;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tupdateData(data)\n\t\t{\n\t\t\tif (!Type.isPlainObject(data))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { avatars, time, statuses, completedTaskCount, workflowIsCompleted, runningTaskId } = data;\n\t\t\tif (!Type.isPlainObject(avatars) && !Type.isPlainObject(time) && !Type.isPlainObject(statuses))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.running = {\n\t\t\t\tavatars: Type.isArray(avatars.running) ? avatars.running : null,\n\t\t\t\ttime: timeValidator(time.running) ? time.running : null,\n\t\t\t};\n\t\t\tthis.completed = {\n\t\t\t\tavatars: Type.isArray(avatars.completed) ? avatars.completed : null,\n\t\t\t\tsuccessStatus: Text.toBoolean(statuses.completedSuccess),\n\t\t\t\ttime: timeValidator(time.completed) ? time.completed : null,\n\t\t\t};\n\t\t\tthis.done = {\n\t\t\t\tavatars: Type.isArray(avatars.done) ? avatars.done : null,\n\t\t\t\tsuccessStatus: Text.toBoolean(statuses.doneSuccess),\n\t\t\t\ttime: timeValidator(time.done) ? time.done : null,\n\t\t\t};\n\t\t\tthis.updateSummary(data);\n\t\t\tthis.runningTaskId = Text.toInteger(runningTaskId);\n\n\t\t\tthis.completedTaskCount = Text.toInteger(completedTaskCount);\n\t\t\tthis.isFinalState = Text.toBoolean(workflowIsCompleted);\n\n\t\t\tif (this.isFinalState)\n\t\t\t{\n\t\t\t\tthis.unsubscribeOnEvents();\n\t\t\t}\n\t\t},\n\t\tupdateSummary(data)\n\t\t{\n\t\t\tconst { time, workflowIsCompleted } = data;\n\n\t\t\tthis.summary.time = timeValidator(time.total) ? time.total : null;\n\t\t\tthis.summary.isFinalState = Text.toBoolean(workflowIsCompleted);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"container\">\n\t\t\t<div class=\"bp-workflow-faces\">\n\t\t\t\t<div v-if=\"hasErrors\" class=\"bp-workflow-faces__steps\">\n\t\t\t\t\t<span class=\"bp-workflow-faces__steps-error\">{{ errorMessage }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"bp-workflow-faces__steps\">\n\t\t\t\t\t<ColumnAuthor\n\t\t\t\t\t\t:avatars=\"author.avatars\"\n\t\t\t\t\t\t:has-more-tasks=\"hasMoreTaskIcon\"\n\t\t\t\t\t\t:tasks-count=\"hiddenTasksCount\"\n\t\t\t\t\t\t:time=\"author.time\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ColumnCompleted\n\t\t\t\t\t\tv-if=\"showCompletedColumn\"\n\t\t\t\t\t\t:avatars=\"completed.avatars\"\n\t\t\t\t\t\t:time=\"completed.time\"\n\t\t\t\t\t\t:success-status=\"completed.successStatus\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ColumnDone\n\t\t\t\t\t\tv-else-if=\"isFinalState\"\n\t\t\t\t\t\t:avatars=\"done.avatars\"\n\t\t\t\t\t\t:time=\"done.time\"\n\t\t\t\t\t\t:success-status=\"done.successStatus\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ColumnRunning\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:avatars=\"running.avatars\"\n\t\t\t\t\t\t:time=\"running.time\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Column v-if=\"!showCompletedColumn\"/>\n\t\t\t\t\t<ColumnDone\n\t\t\t\t\t\tv-else-if=\"isFinalState\"\n\t\t\t\t\t\t:avatars=\"done.avatars\"\n\t\t\t\t\t\t:time=\"done.time\"\n\t\t\t\t\t\t:success-status=\"done.successStatus\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ColumnRunning\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:avatars=\"running.avatars\"\n\t\t\t\t\t\t:time=\"running.time\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Summary v-bind=\"summary\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\n\nimport { Application } from './components/application';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nexport type Avatar = {\n\tid: number,\n\tavatarUrl: ?string,\n};\n\nexport type FacesData = {\n\tavatars: {\n\t\tauthor: Array<Avatar>,\n\t\trunning: Array<Avatar>,\n\t\tcompleted: Array<Avatar>,\n\t\tdone: Array<Avatar>,\n\t},\n\tstatuses: {\n\t\tcompletedSuccess: boolean,\n\t\tdoneSuccess: boolean,\n\t},\n\ttime: {\n\t\tauthor: ?number,\n\t\trunning: ?number,\n\t\tcompleted: ?number,\n\t\tdone: ?number,\n\t\ttotal: ?number,\n\t},\n\tcompletedTaskCount: number,\n\tworkflowIsCompleted: boolean,\n\trunningTaskId: number,\n\tsummaryProps: {\n\t\tshowArrow: boolean,\n\t\tshowContent: boolean,\n\t},\n};\n\nexport class WorkflowFaces\n{\n\t#target: HTMLElement;\n\t#data: FacesData = {};\n\t#workflowId: string;\n\t#targetUserId: number;\n\t#application: VueCreateAppResult;\n\n\t/**\n\t * @param props\n\t * @param {HTMLElement} props.target\n\t * @param {?FacesData} props.data\n\t * @param {string} props.workflowId\n\t * @param {number} props.targetUserId\n\t */\n\tconstructor(props = {})\n\t{\n\t\tif (!Type.isStringFilled(props.workflowId))\n\t\t{\n\t\t\tthrow new TypeError('workflowId must be filled string');\n\t\t}\n\t\tthis.#workflowId = props.workflowId;\n\n\t\tif (!Type.isDomNode(props.target))\n\t\t{\n\t\t\tthrow new TypeError('target must be dom node');\n\t\t}\n\t\tthis.#target = props.target;\n\n\t\tif (!Type.isInteger(props.targetUserId) || props.targetUserId <= 0)\n\t\t{\n\t\t\tthrow new TypeError('targetUserId must be positive integer');\n\t\t}\n\t\tthis.#targetUserId = props.targetUserId;\n\n\t\tif (Type.isPlainObject(props.data))\n\t\t{\n\t\t\tthis.#data = props.data;\n\t\t}\n\n\t\tthis.#initApplication();\n\t}\n\n\t#initApplication()\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst context = this;\n\n\t\tthis.#application = BitrixVue.createApp(\n\t\t\t{\n\t\t\t\tname: 'bp-workflow-faces',\n\t\t\t\tcomponents: {\n\t\t\t\t\tApplication,\n\t\t\t\t},\n\t\t\t\tprops: {\n\t\t\t\t\tworkflowId: String,\n\t\t\t\t\tuserId: Number,\n\t\t\t\t\tavatars: Object,\n\t\t\t\t\tstatuses: Object,\n\t\t\t\t\ttime: Object,\n\t\t\t\t\tcompletedTaskCount: Number,\n\t\t\t\t\tworkflowIsCompleted: Boolean,\n\t\t\t\t\trunningTaskId: Number,\n\t\t\t\t\tsummaryProps: Object,\n\t\t\t\t},\n\t\t\t\tcreated()\n\t\t\t\t{\n\t\t\t\t\tthis.$app = context;\n\t\t\t\t},\n\t\t\t\ttemplate: `\n\t\t\t\t\t<Application\n\t\t\t\t\t\t:workflowId=\"workflowId\"\n\t\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t\t:avatars=\"avatars\"\n\t\t\t\t\t\t:statuses=\"statuses\"\n\t\t\t\t\t\t:time=\"time\"\n\t\t\t\t\t\t:workflow-is-completed=\"workflowIsCompleted\"\n\t\t\t\t\t\t:initial-completed-task-count=\"completedTaskCount\"\n\t\t\t\t\t\t:task-id=\"runningTaskId\"\n\t\t\t\t\t\t:summary-props=\"summaryProps\"\n\t\t\t\t\t></Application>\n\t\t\t\t`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tworkflowId: this.#workflowId,\n\t\t\t\tuserId: this.#targetUserId,\n\t\t\t\tavatars: this.#data.avatars,\n\t\t\t\tstatuses: this.#data.statuses,\n\t\t\t\ttime: this.#data.time,\n\t\t\t\tcompletedTaskCount: this.#data.completedTaskCount,\n\t\t\t\tworkflowIsCompleted: this.#data.workflowIsCompleted,\n\t\t\t\trunningTaskId: this.#data.runningTaskId,\n\t\t\t\tsummaryProps: this.#data.summaryProps,\n\t\t\t},\n\t\t);\n\t}\n\n\trender()\n\t{\n\t\tthis.#application.mount(this.#target);\n\t}\n\n\tupdateData(data: FacesData)\n\t{\n\t\tEventEmitter.emit(this, 'Bizproc.WorkflowFaces.OnUpdateData', new BaseEvent({ data }));\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#application.unmount();\n\t\tthis.#application = null;\n\t\tthis.#target = null;\n\t\tthis.#data = null;\n\t\tthis.#workflowId = null;\n\t}\n}\n"],"names":["Column","name","props","title","String","avatars","Array","status","type","validator","value","includes","hasMoreTasks","Boolean","default","tasksCount","Number","time","computed","hasTitle","Type","isStringFilled","hasFaces","isArrayFilled","hasStatus","hasTime","isNumber","isProgressStatus","isAcceptStatus","isDeclineStatus","duration","isNil","$Bitrix","Loc","getMessage","DateTimeFormat","format","completedTasksCountMessage","methods","getSafeUrl","url","encodeURI","Text","encode","template","ColumnAuthor","components","hasAvatars","loc","phraseCode","ColumnDone","successStatus","TIMER_UP_BOUNDARY","ColumnRunning","data","timer","computedTime","startTime","Math","floor","Date","now","mounted","startTimer","unmounted","stopTimer","setInterval","clearInterval","ColumnCompleted","Summary","workflowId","required","isFinalState","showArrow","showContent","renderSummary","updated","$refs","content","Dom","clean","append","FacesSummary","workflowIsCompleted","render","timeValidator","isNull","toInteger","Application","Object","author","isArray","running","completed","done","statuses","isBoolean","completedSuccess","doneSuccess","total","initialCompletedTaskCount","userId","isInteger","taskId","summaryProps","runningTaskId","completedTaskCount","handleUpdateData","event","updateData","getData","unsubscribePushCallback","summary","errorMessage","showCompletedColumn","hasMoreTaskIcon","hiddenTasksCount","hasErrors","subscribeOnEvents","unsubscribeOnEvents","BX","PULL","subscribe","moduleId","command","callback","onPush","bind","$root","$app","EventEmitter","isFunction","unsubscribe","params","eventName","items","item","id","load","container","ajax","runAction","then","catch","errors","firstError","pop","code","message","isPlainObject","toBoolean","updateSummary","WorkflowFaces","constructor","TypeError","isDomNode","target","targetUserId","mount","emit","BaseEvent","destroy","unmount","context","BitrixVue","createApp","created"],"mappings":"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"}