{"version":3,"file":"summary.bundle.js","sources":["../src/summary.js"],"sourcesContent":["import { Loc, Tag, Type, Text } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Timeline } from 'bizproc.workflow.timeline';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nimport './css/style.css';\n\nexport type SummaryData = {\n\tworkflowId: string,\n\ttime: ?number,\n\tworkflowIsCompleted: boolean,\n\tshowArrow: boolean,\n\tshowContent: boolean,\n\tshowTitle: boolean,\n};\n\nexport class Summary\n{\n\t#isFinal: boolean = false;\n\t#workflowId: string;\n\t#showArrow: boolean;\n\t#showContent: boolean;\n\t#showTitle: boolean;\n\n\tconstructor(props: SummaryData = {})\n\t{\n\t\tif (!Type.isStringFilled(props.workflowId))\n\t\t{\n\t\t\tthrow new TypeError('workflowId must be filled string');\n\t\t}\n\t\tthis.#workflowId = props.workflowId;\n\n\t\tif (Type.isBoolean(props.workflowIsCompleted))\n\t\t{\n\t\t\tthis.#isFinal = props.workflowIsCompleted;\n\t\t}\n\n\t\tthis.#showArrow = Type.isBoolean(props.showArrow) ? props.showArrow : true;\n\t\tthis.#showContent = Type.isBoolean(props.showContent) ? props.showContent : true;\n\t\tthis.#showTitle = Type.isBoolean(props.showTitle) ? props.showTitle : true;\n\n\t\tthis.#calculateDurationTexts(props.time);\n\t}\n\n\t#calculateDurationTexts(time)\n\t{\n\t\tconst duration = (\n\t\t\tType.isNumber(time) && this.#showContent\n\t\t\t\t? DateTimeFormat.format(\n\t\t\t\t\t[['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff']],\n\t\t\t\t\t0,\n\t\t\t\t\ttime,\n\t\t\t\t)\n\t\t\t\t: null\n\t\t);\n\n\t\tthis.durationTexts = { nameBefore: '', value: '', nameAfter: '' };\n\n\t\tif (duration)\n\t\t{\n\t\t\tconst pattern = /\\d+/;\n\t\t\tconst match = duration.match(pattern);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tthis.durationTexts.value = String(match[0]);\n\n\t\t\t\tconst index = duration.indexOf(this.durationTexts.value);\n\t\t\t\tif (index !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.durationTexts.nameBefore = duration.slice(0, index).trim();\n\t\t\t\t\tthis.durationTexts.nameAfter = duration.slice(index + this.durationTexts.value.length).trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.durationTexts.nameAfter = duration;\n\t\t\t}\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst title = Loc.getMessage(\n\t\t\tthis.#isFinal\n\t\t\t\t? 'BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TITLE_FINAL'\n\t\t\t\t: 'BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TITLE'\n\t\t\t,\n\t\t);\n\n\t\tif (this.#showContent)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-workflow-faces__steps-item --result --summary ${this.#showArrow ? '' : '--arrow-hidden'}\">\n\t\t\t\t\t<div class=\"bp-workflow-faces__steps-name\">\n\t\t\t\t\t\t<span class=\"bp-workflow-faces__text-area\">${this.#showTitle ? Text.encode(title) : ''}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#renderContent()}\n\t\t\t\t\t<div class=\"bp-workflow-faces__steps-duration\" onclick=\"${this.#openTimeline.bind(this)}\">\n\t\t\t\t\t\t<a href=\"#\" class=\"bp-workflow-faces__text-area\">\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TIMELINE')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces__steps-item --result --summary --content-hidden\"></div>\n\t\t`;\n\t}\n\n\t#renderContent(): HTMLElement\n\t{\n\t\tif (this.#isFinal)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-workflow-faces__steps-summary\">\n\t\t\t\t\t<div class=\"bp-workflow-faces__steps-summary-name\">${Text.encode(this.durationTexts.nameBefore)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces__steps-summary-value\">${Text.encode(this.durationTexts.value)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces__steps-summary-name\">${Text.encode(this.durationTexts.nameAfter)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces__steps-users\">\n\t\t\t\t<div class=\"ui-icon-set --clock-2 bp-workflow-faces__steps-user\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#openTimeline(event)\n\t{\n\t\tevent.preventDefault();\n\t\tTimeline.open({ workflowId: this.#workflowId });\n\t}\n}\n"],"names":["Summary","constructor","props","Type","isStringFilled","workflowId","TypeError","isBoolean","workflowIsCompleted","showArrow","showContent","showTitle","time","render","title","Loc","getMessage","Tag","Text","encode","bind","duration","isNumber","DateTimeFormat","format","durationTexts","nameBefore","value","nameAfter","pattern","match","String","index","indexOf","slice","trim","length","event","preventDefault","Timeline","open"],"mappings":"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"}