this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,i,t,a,l,r,o,c,n){"use strict";let p=e=>e,d,b;var v=babelHelpers.classPrivateFieldLooseKey("errors");class L{constructor(e){Object.defineProperty(this,v,{writable:true,value:[]});if(c.Type.isArrayFilled(e.errors)){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.errors}}render(){return c.Tag.render(d||(d=p`
			<div class="bizproc-workflow-timeline_error-wrapper">
				<div class="bizproc-workflow-timeline_error-inner">
					${0}
					<div class="bizproc-workflow-timeline_error-img"></div>
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,v)[v].map((({message:e})=>c.Tag.render(b||(b=p`
						<p class="bizproc-workflow-timeline_error-text">${0}</p>
					`),c.Text.encode(e)))))}renderTo(e){c.Dom.append(this.render(),e)}}var u=babelHelpers.classPrivateFieldLooseKey("data");class P{constructor(e){Object.defineProperty(this,u,{writable:true,value:{}});if(c.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e}}canView(){return c.Type.isBoolean(babelHelpers.classPrivateFieldLooseBase(this,u)[u].canView)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].canView:false}get status(){return new n.TaskStatus(babelHelpers.classPrivateFieldLooseBase(this,u)[u].status)}get id(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,u)[u].id)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].id:0}get name(){return c.Type.isString(babelHelpers.classPrivateFieldLooseBase(this,u)[u].name)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].name:""}get modified(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,u)[u].modified)?Math.max(babelHelpers.classPrivateFieldLooseBase(this,u)[u].modified,0):0}get users(){return c.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,u)[u].users)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].users:[]}get executionTime(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,u)[u].executionTime)?Math.max(babelHelpers.classPrivateFieldLooseBase(this,u)[u].executionTime,0):null}get approveType(){return c.Type.isString(babelHelpers.classPrivateFieldLooseBase(this,u)[u].approveType)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].approveType:""}get url(){return c.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,u)[u].url)?babelHelpers.classPrivateFieldLooseBase(this,u)[u].url:null}}let f=e=>e,I,h,F,_,B,m,E,O,T,R,g,H,w,y,M,S,N,k,W;var D=babelHelpers.classPrivateFieldLooseKey("limits");var K=babelHelpers.classPrivateFieldLooseKey("getFormatString");var C=babelHelpers.classPrivateFieldLooseKey("getMultiplierByFormat");class z{static formatTimestamp(e){return o.DateTimeFormat.format(babelHelpers.classPrivateFieldLooseBase(this,K)[K](Date.now()/1e3-e),e)}static formatTimeInterval(e,s=1){if(c.Type.isNil(e)){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME_UNKNOWN")}if(e===0){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_ZERO_SECOND_INTERVAL")}let i="";let t=e;for(let e=0;e<s;e++){const e=babelHelpers.classPrivateFieldLooseBase(this,K)[K](t);if(i.length>0&&e==="sdiff"){return i}const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C](e);i+=o.DateTimeFormat.format(e,0,t);i+=" ";if(s>0){t%=s;if(t===0){return i}}}return i}static formatDate(e,s){return o.DateTimeFormat.format(s,e)}}function $(e){for(const s of babelHelpers.classPrivateFieldLooseBase(this,D)[D]){if(e>s[0]){return s[1]}}return"sdiff"}function j(e){for(const s of babelHelpers.classPrivateFieldLooseBase(this,D)[D]){if(e===s[1]){return s[0]}}return 0}Object.defineProperty(z,C,{value:j});Object.defineProperty(z,K,{value:$});Object.defineProperty(z,D,{writable:true,value:[[3600*24*30*12,"Ydiff"],[3600*24*30,"mdiff"],[3600*24,"ddiff"],[3600,"Hdiff"],[60,"idiff"]]});var x=babelHelpers.classPrivateFieldLooseKey("workflowId");var Z=babelHelpers.classPrivateFieldLooseKey("data");var A=babelHelpers.classPrivateFieldLooseKey("isLoaded");var X=babelHelpers.classPrivateFieldLooseKey("errors");var U=babelHelpers.classPrivateFieldLooseKey("container");var G=babelHelpers.classPrivateFieldLooseKey("biPopup");var V=babelHelpers.classPrivateFieldLooseKey("dateFormat");var Y=babelHelpers.classPrivateFieldLooseKey("tooLongProcessDuration");var q=babelHelpers.classPrivateFieldLooseKey("loadTimeline");var Q=babelHelpers.classPrivateFieldLooseKey("setDataFromResponse");var J=babelHelpers.classPrivateFieldLooseKey("renderItemTitle");var ee=babelHelpers.classPrivateFieldLooseKey("renderSubject");var se=babelHelpers.classPrivateFieldLooseKey("renderProceedTaskButton");var ie=babelHelpers.classPrivateFieldLooseKey("renderUser");var te=babelHelpers.classPrivateFieldLooseKey("renderDoc");var ae=babelHelpers.classPrivateFieldLooseKey("renderCaption");var le=babelHelpers.classPrivateFieldLooseKey("renderNotice");var re=babelHelpers.classPrivateFieldLooseKey("renderHighlightedNotice");var oe=babelHelpers.classPrivateFieldLooseKey("renderStatus");var ce=babelHelpers.classPrivateFieldLooseKey("renderMore");var ne=babelHelpers.classPrivateFieldLooseKey("renderContent");var pe=babelHelpers.classPrivateFieldLooseKey("renderItem");var de=babelHelpers.classPrivateFieldLooseKey("renderUserList");var be=babelHelpers.classPrivateFieldLooseKey("renderVoteCaption");var ve=babelHelpers.classPrivateFieldLooseKey("renderItemsList");var Le=babelHelpers.classPrivateFieldLooseKey("renderFirstBlock");var ue=babelHelpers.classPrivateFieldLooseKey("renderContainer");var Pe=babelHelpers.classPrivateFieldLooseKey("textCrop");var fe=babelHelpers.classPrivateFieldLooseKey("createEfficiencyPopup");var Ie=babelHelpers.classPrivateFieldLooseKey("getEfficiencyData");var he=babelHelpers.classPrivateFieldLooseKey("renderEfficiencyInlineContent");var Fe=babelHelpers.classPrivateFieldLooseKey("renderEfficiencyPopupContent");var _e=babelHelpers.classPrivateFieldLooseKey("getBiPopup");var Be=babelHelpers.classPrivateFieldLooseKey("createBiPopup");var me=babelHelpers.classPrivateFieldLooseKey("renderBiPopupContent");var Ee=babelHelpers.classPrivateFieldLooseKey("renderLoadingStub");var Oe=babelHelpers.classPrivateFieldLooseKey("hasErrors");class Te{constructor(e,s){Object.defineProperty(this,Oe,{value:is});Object.defineProperty(this,Ee,{value:ss});Object.defineProperty(this,me,{value:es});Object.defineProperty(this,Be,{value:Je});Object.defineProperty(this,_e,{value:Qe});Object.defineProperty(this,Fe,{value:qe});Object.defineProperty(this,he,{value:Ye});Object.defineProperty(this,Ie,{value:Ve});Object.defineProperty(this,fe,{value:Ge});Object.defineProperty(this,Pe,{value:Ue});Object.defineProperty(this,ue,{value:Xe});Object.defineProperty(this,Le,{value:Ae});Object.defineProperty(this,ve,{value:Ze});Object.defineProperty(this,be,{value:xe});Object.defineProperty(this,de,{value:je});Object.defineProperty(this,pe,{value:$e});Object.defineProperty(this,ne,{value:ze});Object.defineProperty(this,ce,{value:Ce});Object.defineProperty(this,oe,{value:Ke});Object.defineProperty(this,re,{value:De});Object.defineProperty(this,le,{value:We});Object.defineProperty(this,ae,{value:ke});Object.defineProperty(this,te,{value:Ne});Object.defineProperty(this,ie,{value:Se});Object.defineProperty(this,se,{value:Me});Object.defineProperty(this,ee,{value:ye});Object.defineProperty(this,J,{value:we});Object.defineProperty(this,Q,{value:He});Object.defineProperty(this,q,{value:ge});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,A,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:[]});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,U)[U]=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()}),500);if(c.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.workflowId;babelHelpers.classPrivateFieldLooseBase(this,A)[A]=false;babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}if(c.Type.isPlainObject(s)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=`${s.dateFormat||"j F Y"} ${s.timeFormat||"H:i"}`}}static open(e){c.Runtime.loadExtension("sidepanel").then((()=>{BX.SidePanel.Instance.open(c.Uri.addParam("/bitrix/components/bitrix/bizproc.workflow.timeline.slider/index.php",c.Type.isPlainObject(e)?e:{}),{width:950,allowChangeHistory:false,cacheable:false,loader:"/bitrix/js/bizproc/workflow/timeline/img/skeleton.svg"})})).catch((e=>console.error(e.errors)))}render(){c.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,U)[U]);if(babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]()){const e=new L({errors:babelHelpers.classPrivateFieldLooseBase(this,X)[X]});e.renderTo(babelHelpers.classPrivateFieldLooseBase(this,U)[U]);return babelHelpers.classPrivateFieldLooseBase(this,U)[U]}if(!babelHelpers.classPrivateFieldLooseBase(this,A)[A]){c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](),babelHelpers.classPrivateFieldLooseBase(this,U)[U])}if(c.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])){c.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,U)[U],babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]());babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]().show()}return babelHelpers.classPrivateFieldLooseBase(this,U)[U]}getStatusName(e,s="",i=1){if(e.isYes()||e.isOk()){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED")}if(e.isNo()||e.isCancel()){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_DECLINED")}if(e.isWaiting()){if(i===1){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING")}let e="";switch(s){case"all":e=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING_ALL");break;case"any":e=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING_ANY");break;case"vote":e=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING_ALL");break;default:e=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING");break}return e}return e.name}showBiPopup(){babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]().show()}}function Re(){return 60*60*24*3}function ge(){c.ajax.runAction("bizproc.workflow.getTimeline",{data:{workflowId:babelHelpers.classPrivateFieldLooseBase(this,x)[x]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e);babelHelpers.classPrivateFieldLooseBase(this,A)[A]=true;this.render()})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e);babelHelpers.classPrivateFieldLooseBase(this,A)[A]=true;this.render()}))}function He(e){if(c.Type.isPlainObject(e)){const i=(e,s="")=>c.Type.isString(e)?e:s;const t=(e,s=[])=>c.Type.isArray(e)?e:s;const a=(e,s=false)=>c.Type.isBoolean(e)?e:s;const l=(e,s=0)=>c.Type.isInteger(e)?e:s;if(c.Type.isPlainObject(e.data)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]={document:new s.DocumentId({documentId:t(e.data.documentType),entityName:i(e.data.entityName),documentName:i(e.data.documentName),documentUrl:i(e.data.documentUrl),moduleName:i(e.data.moduleName)}),isWorkflowRunning:a(e.data.isWorkflowRunning),timeToStart:l(e.data.timeToStart,null),executionTime:l(e.data.executionTime,null),started:l(e.data.started,null),startedBy:l(e.data.startedBy),tasks:t(e.data.tasks).map((e=>new P(e))),users:new Map,stats:{averageDuration:l(e.data.stats.averageDuration,null),efficiency:i(e.data.stats.efficiency)}};for(const s of t(e.data.users)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].users.set(c.Text.toInteger(s.id),s)}}babelHelpers.classPrivateFieldLooseBase(this,X)[X]=t(e.errors)}}function we(e,s,i,t){const a=c.Type.isString(s)?` ${s}`:"";const l=c.Type.isString(i)?i:"";const r=t?' data-crop="crop"':"";return c.Tag.render(I||(I=f`
			<div>
				<span class="bizproc-workflow-timeline-icon${0}">${0}</span>
				<div class="bizproc-workflow-timeline-title"${0}>${0}</div>
			</div>
		`),a,l,r,c.Text.encode(e))}function ye(e){return c.Tag.render(h||(h=f`
			<div class="bizproc-workflow-timeline-subject">${0}</div>
		`),c.Text.encode(e))}function Me(e){const s=e.url||new c.Uri("/bitrix/components/bitrix/bizproc.workflow.info/").setQueryParams({workflow:babelHelpers.classPrivateFieldLooseBase(this,x)[x],task:e.id}).toString();return c.Tag.render(F||(F=f`
			<div class="task-button --hidden">
				<a class="ui-btn ui-btn-xs ui-btn-primary ui-btn-round" href="${0}">
					${0}
				</a>
			</div>
		`),c.Text.encode(s),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BUTTON_PROCEED"))}function Se(e,s=null,i=null){const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].users.get(e||s.id);let a="";let l=false;if(s){const e=new n.TaskStatus(s.status);if(e.isYes()||e.isOk()){a=" --voted-up"}if(e.isNo()){a=" --voted-down"}if(e.isWaiting()){l=true}}const r=c.Type.isString(t.workPosition)?`<div class="bizproc-workflow-timeline-user-pos">${c.Text.encode(t.workPosition)}</div>`:"";let o="<i></i>";if(c.Type.isString(t.avatarSize100)){o=`<i style="background-image: url('${t.avatarSize100}')"></i>`}const p=i!=null&&i.id&&l?babelHelpers.classPrivateFieldLooseBase(this,se)[se](i):"";return c.Tag.render(_||(_=f`
			<div class="bizproc-workflow-timeline-user${0}">
				<div class="bizproc-workflow-timeline-userlogo ui-icon ui-icon-common-user">
					${0}
				</div>
				<div class="bizproc-workflow-timeline-user-block">
					<a class="bizproc-workflow-timeline-link" href="${0}">${0}</a>
					${0}
				</div>
				${0}
			</div>
		`),a,o,t.link,c.Text.encode(t.fullName),r,p)}function Ne(e,s,i,t){return c.Tag.render(B||(B=f`
			<div class="bizproc-workflow-timeline-doc">
				${0}
				<div class="bizproc-workflow-timeline-type">
					<span class="ui-icon-set ${0}"></span>
					<span class="bizproc-workflow-timeline-type-text">${0}</span>
				</div>
				<a class="bizproc-workflow-timeline-link" href="${0}" target="_top">${0}</a>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_START_DOC")),t,i,s,c.Text.encode(e))}function ke(e){return c.Tag.render(m||(m=f`
			<div class="bizproc-workflow-timeline-caption">${0}</div>
		`),e)}function We(e,s){return c.Tag.render(E||(E=f`
			<div class="bizproc-workflow-timeline-notice">
				<div class="bizproc-workflow-timeline-subject">${0}</div>
				<span class="bizproc-workflow-timeline-text">${0}</span>
			</div>
		`),c.Text.encode(e),c.Text.encode(s))}function De(e,s){const i=c.Tag.render(O||(O=f`
			<div class="bizproc-workflow-timeline-notice">
				<div class="bizproc-workflow-timeline-subject">${0}</div>
				<span class="bizproc-workflow-timeline-text">${0}</span>
				<span
					data-hint="${0}"
				></span>
			</div>
		`),c.Text.encode(e),c.Text.encode(s),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_TIME_LIMIT_EXCEEDED"));BX.UI.Hint.init(i);return i}function Ke(e,s){const i=c.Type.isString(s)?` ${s}`:"";return c.Tag.render(T||(T=f`
			<div class="bizproc-workflow-timeline-status${0}">${0}</div>
		`),i,c.Text.encode(e))}function Ce(){return c.Tag.render(R||(R=f`
			<div class="bizproc-workflow-timeline-item --more">
				<div class="bizproc-workflow-timeline-item-inner">
					<span class="bizproc-workflow-timeline-icon"></span>
					<button class="ui-btn ui-btn-light-border ui-btn-xs" type="button" onclick="expandMore(event)">
						<span class="ui-btn-text">
							${0}
						</span>
					</button>
					<script type="text/javascript">
						function expandMore(event)
						{
							const moreItemBlock = event.target.closest('.--more');
							const hiddenBlocks = document.querySelectorAll('.bizproc-workflow-timeline-item.--hidden:not(.--efficiency)');
							BX.Dom.addClass(moreItemBlock, '--hidden');
							hiddenBlocks.forEach((hiddenBlock) => BX.Dom.removeClass(hiddenBlock, '--hidden'));
						}
					</script>
				</div>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_MORE_TASKS"))}function ze(e){return c.Tag.render(g||(g=f`
			<div class="bizproc-workflow-timeline-content">
				${0}
			</div>
		`),e)}function $e(e,s,i){const t=c.Type.isString(s)?` ${s}`:"";const a=c.Type.isString(i)?` data-efficiency-class="${i}"`:"";return c.Tag.render(H||(H=f`
			<div class="bizproc-workflow-timeline-item${0}"${0}>
				<div class="bizproc-workflow-timeline-item-inner">
					${0}
				</div>
			</div>
		`),t,a,e)}function je(e){let s="";if(e.length===1){s=c.Tag.render(w||(w=f`
				<script type="text/javascript">
					(function () {
						for (let userItem of document
							.currentScript
							.closest('.bizproc-workflow-timeline-user-list')
							.querySelectorAll('.bizproc-workflow-timeline-user')
						)
						{
							BX.Dom.removeClass(userItem, ['--voted-up', '--voted-down']);
						}
					}
					)();
				</script>
			`))}return c.Tag.render(y||(y=f`
			<div class="bizproc-workflow-timeline-user-list">
				${0}
				${0}
			</div>
		`),e,s)}function xe(e,s){return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_VOTED",{"#VOTED#":e,"#TOTAL#":s}))}function Ze(e){return c.Tag.render(M||(M=f`
			<div class="bizproc-workflow-timeline-wrapper">
				<div class="bizproc-workflow-timeline-inner">
					<div class="bizproc-workflow-timeline-list">
						${0}
					</div>
					<script type="text/javascript">
						(function() {
							const buttons = document.querySelectorAll('.task-button.--hidden');
							const showButtons = buttons.length > 1;
							buttons.forEach(function (button) {
								BX.Dom.insertBefore(
									button.closest('.bizproc-workflow-timeline-user'),
									button.closest('.bizproc-workflow-timeline-user-list').firstChild
								);
								if (showButtons)
								{
									BX.Dom.removeClass(button, '--hidden')									
								}
							});
						})();
					</script>
				</div>
			</div>
		`),e)}function Ae(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].startedBy){e.push(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_FROM")),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].startedBy))}e.push(babelHelpers.classPrivateFieldLooseBase(this,te)[te](babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].document.name,babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].document.url,babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].document.moduleName,"--file-2"));if(!c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].timeToStart)){e.push(babelHelpers.classPrivateFieldLooseBase(this,le)[le](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EXECUTION_TIME"),z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].timeToStart,2)))}return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].document.entityName,"--success","1"),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].started&&babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](z.formatDate(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].started,babelHelpers.classPrivateFieldLooseBase(this,V)[V])),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e)],"--selected")}function Xe(){const e=[];let s="";let i=false;if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){let t=1;let a=null;let l=false;let r=c.Loc.getMessage("USER_ID");r=r?parseInt(r,10):null;e.push(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]());for(const s of Object.keys(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].tasks)){a=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].tasks[s];let o=null;let p=true;i=a.status.isWaiting();if(a.canView()){const s=[];if(i){if(l){e.push(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]());l=false}o="--processing";p=false;if(a.approveType==="vote"){let e=0;for(const s of a.users){if(!new n.TaskStatus(s.status).isWaiting()){e++}}s.push(babelHelpers.classPrivateFieldLooseBase(this,be)[be](e,a.users.length))}else{s.push(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](this.getStatusName(a.status,a.approveType,a.users.length)))}}else{l=true;if(a.status.isOk()||a.status.isYes()){o="--success"}s.push(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](this.getStatusName(a.status)))}const d=[];for(const e of Object.values(a.users)){d.push(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](null,e,e.id===r?a:null))}if(d.length>0){s.push(babelHelpers.classPrivateFieldLooseBase(this,de)[de](d))}if(!c.Type.isNil(a.executionTime)){s.push(a.executionTime<babelHelpers.classPrivateFieldLooseBase(Te,Y)[Y]()?babelHelpers.classPrivateFieldLooseBase(this,le)[le](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EXECUTION_TIME"),z.formatTimeInterval(a.executionTime,2)):babelHelpers.classPrivateFieldLooseBase(this,re)[re](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EXECUTION_TIME"),z.formatTimeInterval(a.executionTime,2)))}e.push(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](a.name,o,p?(++t).toString():null),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](z.formatDate(a.modified,babelHelpers.classPrivateFieldLooseBase(this,V)[V])),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](s)],i?"--processing":"--hidden"))}else{let s="--tech";if(i&&babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].tasks.length>1){s+=" --hidden";l=true}e.push(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_RIGHTS_TO_VIEW")),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_RIGHTS_TO_VIEW_TIP"))],s))}}if(l){e.push(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]())}if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].isWorkflowRunning){if(i){e.push(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS")),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_TIP"))],"--tech --previous-item"))}else{e.push(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_INTERMEDIATE")),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_INTERMEDIATE_TIP"))],"--tech --previous-item"))}}else{const i=!a||a.status.isOk()||a.status.isYes();const t=[babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PROCESS_FINISHED"))];if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].startedBy){t.push(i?babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_APPROVED_FOR")):babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_DECLINED"),"--failure"),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].startedBy))}t.push(babelHelpers.classPrivateFieldLooseBase(this,le)[le](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PROCESS_EXECUTED"),z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].executionTime)));s=i?"--success":"--declined";e.push(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]([babelHelpers.classPrivateFieldLooseBase(this,J)[J](babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].document.entityName,i?"--success":null),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].started&&babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](z.formatDate(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].started+babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].executionTime,babelHelpers.classPrivateFieldLooseBase(this,V)[V])),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](t)],i?"--success --previous":"--declined --selected --previous",s),babelHelpers.classPrivateFieldLooseBase(this,he)[he]())}}return babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e)}function Ue(){const e=document.querySelectorAll('[data-crop="crop"]');for(const s of e){const e=new l.TextCrop({rows:2,target:s});e.init()}}function Ge(){return new r.Popup({width:403,minHeight:345,closeIcon:true,content:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](),bindElement:{left:555,top:130},padding:26,borderRadius:"18px",className:"--bizproc-timeline-popup",events:{onPopupClose:()=>{let e=document.querySelector(".--previous-item");if(!e){e=document.querySelector(".bizproc-workflow-timeline-item.--processing")}if(!e){return}BX.Dom.addClass(e,"--previous");let s=e.getAttribute("data-efficiency-class");if(!s){s=""}e.after(babelHelpers.classPrivateFieldLooseBase(this,he)[he](s))}}})}function Ve(){let e="--first";let s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_STATS");switch(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].stats.efficiency){case"fast":if(z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].stats.averageDuration)===z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].executionTime)){e="--slow";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_SLOWLY")}else{e="--fast";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_QUICKLY")}break;case"slow":e="--slow";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_SLOWLY");break;case"stopped":e="--stopped";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_NO_PROGRESS");break;default:break}return[e,s]}function Ye(e){const[s,i]=babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]();const t=c.Tag.render(S||(S=f`
			<div class="bizproc-workflow-timeline-item --efficiency ${0}">
				<div class="bizproc-workflow-timeline-item-inner">
					<div class="bizproc-workflow-timeline-title">
						${0}
					</div>
					<div class="bizproc-workflow-timeline-content">
						<div class="bizproc-workflow-timeline-eff-icon ${0}"></div>
						<div class="bizproc-workflow-timeline-content-inner">
							<div class="bizproc-workflow-timeline-caption">${0}</div>
							<div class="bizproc-workflow-timeline-notice">
								<div class="bizproc-workflow-timeline-subject">
									${0}
								</div>
								<span class="bizproc-workflow-timeline-text">
									${0}
								</span>
								<span
									data-hint="${0}"
								></span>
							</div>
							<div class="bizproc-workflow-timeline-notice">
								<div class="bizproc-workflow-timeline-subject">
									${0}
								</div>
								<span class="bizproc-workflow-timeline-text">
									${0}
								</span>
							</div>
						</div>
					</div>
				</div>	
			</div>
		`),e,c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EFFECTIVITY_MARK"),s,i,c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_CURRENT_PROCESS_TIME"),z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].executionTime),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_TIME_DIFFERENCE"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME"),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].stats.averageDuration===null?c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME_UNKNOWN"):z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].stats.averageDuration));BX.UI.Hint.init(t);return t}function qe(){const[e,s]=babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]();const i=c.Tag.render(N||(N=f`
			<div class="bizproc-timeline-popup">
				<div class="bizproc-timeline-popup-title">
					${0}
				</div>
				<div class="bizproc-timeline-popup-main">
					<div class="bizproc-timeline-popup-status">
						<div class="bizproc-timeline-popup-logo ${0}"></div>
						<div class="bizproc-timeline-popup-notice">${0}</div>
					</div>
					<div class="bizproc-timeline-popup-content">
						<div class="bizproc-timeline-popup-block">
							<span class="bizproc-timeline-popup-val">
								${0}
							</span>
							<span
								data-hint="${0}"
							></span>
							<div class="bizproc-timeline-popup-prop">
								${0}
							</div>
						</div>
						<div class="bizproc-timeline-popup-block">
							<span class="bizproc-timeline-popup-val">
								${0}
							</span>
							<div class="bizproc-timeline-popup-prop">
								${0}
							</div>
						</div>
					</div>
				</div>
				<div class="bizproc-timeline-popup-footer">
					<p class="bizproc-timeline-popup-text">
						${0}
					</p>
					<a class="bizproc-timeline-popup-text" href="javascript:top.BX.Helper.show('redirect=detail&code=18783714')">
						${0}
					</a>
				</div>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EFFECTIVITY_MARK"),e,s,z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].executionTime),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_TIME_DIFFERENCE"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_CURRENT_PROCESS_TIME"),z.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].stats.averageDuration),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMANCE_TUNING_TIP"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMANCE_TUNING_LINK"));BX.UI.Hint.init(i);return i}function Qe(){if(!babelHelpers.classPrivateFieldLooseBase(this,G)[G]){return babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]()}return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}function Je(){babelHelpers.classPrivateFieldLooseBase(this,G)[G]=new r.Popup({width:403,minHeight:183,closeIcon:true,content:babelHelpers.classPrivateFieldLooseBase(this,me)[me](),bindElement:{left:207,top:482},padding:17,borderRadius:"18px",className:"--bizproc-timeline-popup --bi"});return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}function es(){return c.Tag.render(k||(k=f`
			<div class="bizproc-timeline-popup">
				<div class="bizproc-timeline-popup-title">${0}</div>
				<p class="bizproc-timeline-popup-info">${0}</p>
				<button class="ui-btn ui-btn-light-border ui-btn-round ui-btn-xs">
					<span class="ui-btn-text">${0}</span>
				</button>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_TITLE"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_TIP"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_LINK"))}function ss(){return c.Tag.render(W||(W=f`
			<img src="/bitrix/js/bizproc/workflow/timeline/img/skeleton.svg"
				 style="width:100%; margin: 0; padding: 0;"/>
		`))}function is(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X].length>0}Object.defineProperty(Te,Y,{value:Re});e.DurationFormatter=z;e.Timeline=Te})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.Bizproc,BX.Bizproc,BX,BX,BX.UI,BX.Main,BX.Main,BX,BX.Bizproc);
//# sourceMappingURL=timeline.bundle.map.js