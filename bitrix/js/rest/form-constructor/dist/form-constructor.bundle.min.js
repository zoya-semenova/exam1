this.BX=this.BX||{};(function(e,t,a,i){"use strict";var r,n;function s(e,t,a){l(e,t);t.set(e,a)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var o=new WeakMap;var p=function(e){babelHelpers.inherits(t,e);function t(e){var i;var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));s(babelHelpers.assertThisInitialized(r),o,{writable:true,value:void 0});r.setEventNamespace("BX.Rest.EInvoice.Field");r.options=e;r.value=(i=r.options.value)!==null&&i!==void 0?i:null;r.readySave=!(a.Type.isNil(r.value)||r.value==="");r.options.id=a.Type.isStringFilled(r.options.id)?r.options.id:a.Text.getRandom(8);return r}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.options.id}},{key:"getName",value:function e(){return this.options.name}},{key:"getContent",value:function e(){var t=this;var i=a.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="container"></div>\n\t\t'])));a.Dom.append(this.renderFieldContainer(),i);a.Dom.append(this.renderErrorsContainer(),i);a.Dom.hide(this.renderErrorsContainer());this.subscribe("error",(function(e){var r=e.data.messages;t.renderErrorsContainer().innerHTML=a.Type.isArray(r)?r.join("<br>"):r;a.Dom.show(t.renderErrorsContainer());if(!a.Dom.hasClass(i,"ui-ctl-warning")){a.Dom.addClass(i,"ui-ctl-warning")}}));return i}},{key:"renderFieldContainer",value:function e(){throw new Error("Must be implemented in a child class")}},{key:"isReadySave",value:function e(){return this.readySave}},{key:"renderErrorsContainer",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,o)){babelHelpers.classPrivateFieldSet(this,o,a.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl-bottom bitrix-einvoice-error-block"></div>\n\t\t\t']))))}return babelHelpers.classPrivateFieldGet(this,o)}},{key:"getValue",value:function e(){return this.value}}]);return t}(i.EventEmitter);var c,d,u;var v=function(e){babelHelpers.inherits(t,e);function t(e){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));a.readySave=true;return a}babelHelpers.createClass(t,[{key:"renderFieldContainer",value:function e(){var t=this;var i=a.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t</div>\n\t\t'])));if(a.Type.isArray(this.options.items)){var r=a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<select class="ui-ctl-element" id="','" />\n\t\t\t'])),this.getId());this.options.items.forEach((function(e){var i=a.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">',"</option>\n\t\t\t\t"])),e.value,e.name);if(t.options.value===e.value){a.Dom.attr(i,{selected:true})}a.Dom.append(i,r)}));a.Dom.append(r,i);a.Event.bind(r,"change",(function(e){t.value=e.target.value;if(Object.prototype.hasOwnProperty.call(t.options,"updateForm")&&t.options.updateForm){t.emit("onFieldChange",{target:e.target,field:t})}}))}return i}}]);return t}(p);var b,h,f;var g=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"renderFieldContainer",value:function e(){var t=this;var i=a.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl-container"/>\n\t\t'])));if(this.options.label){var r=a.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t<div class="ui-ctl-title">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),this.options.label);a.Dom.append(r,i)}var n=a.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t<input type="text" id="','" class="ui-ctl-element">\n\t\t\t</div>\n\t\t'])),this.getId());var s=n.querySelector("input");if(this.options.placeholder){a.Dom.attr(s,{placeholder:this.options.placeholder})}if(this.options.value){a.Dom.attr(s,{value:this.options.value})}a.Event.bind(s,"input",(function(e){a.Dom.hide(t.renderErrorsContainer());if(a.Dom.hasClass(i,"ui-ctl-warning")){a.Dom.removeClass(i,"ui-ctl-warning")}if(a.Type.isNil(e.target.value)||e.target.value===""){t.emit("onUnreadySave");t.readySave=false}else{t.emit("onReadySave");t.readySave=true}t.value=e.target.value}));a.Dom.append(n,i);return i}}]);return t}(p);var m,y,H,T;function w(e,t){k(e,t);t.add(e)}function C(e,t,a){k(e,t);t.set(e,a)}function k(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function E(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var F=new WeakMap;var S=new WeakMap;var D=new WeakMap;var I=new WeakSet;var P=new WeakSet;var x=function(e){babelHelpers.inherits(r,e);function r(e){var i;babelHelpers.classCallCheck(this,r);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this));w(babelHelpers.assertThisInitialized(i),P);w(babelHelpers.assertThisInitialized(i),I);C(babelHelpers.assertThisInitialized(i),F,{writable:true,value:void 0});C(babelHelpers.assertThisInitialized(i),S,{writable:true,value:void 0});C(babelHelpers.assertThisInitialized(i),D,{writable:true,value:void 0});i.setEventNamespace("BX.Rest.EInvoice");if(!a.Type.isArray(e.steps)){throw new Error('Unexpected property type  "steps", expected type array')}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),F,e);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),S,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),D,new t.StepByStep({content:E(babelHelpers.assertThisInitialized(i),I,R).call(babelHelpers.assertThisInitialized(i))}));return i}babelHelpers.createClass(r,[{key:"getFields",value:function e(){return babelHelpers.classPrivateFieldGet(this,S)}},{key:"render",value:function e(){return babelHelpers.classPrivateFieldGet(this,D).getContentWrapper()}},{key:"renderTo",value:function e(t){babelHelpers.classPrivateFieldGet(this,D).target=t;babelHelpers.classPrivateFieldGet(this,D).init()}},{key:"getFormData",value:function e(){var t={};babelHelpers.classPrivateFieldGet(this,S).forEach((function(e){if(e.isReadySave()){t[e.getName()]=e.getValue()}}));return t}},{key:"showFieldErrors",value:function e(t){var a=this;var r=function e(){var t=babelHelpers.slicedToArray(s[n],2),r=t[0],l=t[1];babelHelpers.classPrivateFieldGet(a,S).forEach((function(e){if(e.getName()===r){e.emit("error",new i.BaseEvent({data:{messages:l}}))}}))};for(var n=0,s=Object.entries(t);n<s.length;n++){r()}}},{key:"showTextInBalloon",value:function e(t){BX.UI.Notification.Center.notify({id:"einvoice-error-save-settings",content:a.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="bitrix-einvoice-settings-notification-wrapper">\n\t\t\t\t\t\t\t<span class="ui-icon-set --warning"></span>\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"])),t),autoHideDelay:5e3})}}]);return r}(i.EventEmitter);function R(){var e=this;var t=[];babelHelpers.classPrivateFieldGet(this,F).steps.forEach((function(a){var i={html:[{backgroundColor:"#ffffff"}]};if(a.title){i.html[0].header={title:a.title}}i.html[0].node=E(e,P,z).call(e,a);t.push(i)}));return t}function z(e){var t=this;var i=a.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bitrix-einvoice-settings-step__wrapper"></div>\n\t\t'])));if(e.description){var r=a.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bitrix-einvoice-settings-step__description">',"</div>\n\t\t\t"])),e.description);a.Dom.append(r,i)}if(e.fields){e.fields.forEach((function(e,r){var n;switch(e.type){case"input":n=new g(e);break;case"dropdown-list":n=new v(e);break;default:throw new Error("Incorrect field type")}if(n instanceof p){n.subscribe("onReadySave",(function(){t.emit("onReadySave")}));n.subscribe("onUnreadySave",(function(){t.emit("onUnreadySave")}));n.subscribe("onFieldChange",(function(e){t.emit("onFieldChange",e)}));babelHelpers.classPrivateFieldGet(t,S).push(n);var s=n.getContent();a.Dom.append(s,i);if(r>0){a.Dom.style(s,"margin-top","12px")}}}))}if(e.link&&e.link.url.startsWith("https://")){var n=a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bitrix-einvoice-settings-step-wrapper-link">\n\t\t\t\t\t<a href="','" class="bitrix-einvoice-settings-step__link">',"</a>\n\t\t\t\t</div>\n\t\t\t"])),e.link.url,a.Text.encode(e.link.name));a.Dom.append(n,i)}return i}e.FormConstructor=x})(this.BX.Rest=this.BX.Rest||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=form-constructor.bundle.map.js