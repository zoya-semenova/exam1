{"version":3,"file":"formatter.bundle.js","sources":["../src/node-formatter.js","../src/formatter.js"],"sourcesContent":["import { Type } from 'main.core';\nimport {\n\tBBCodeNode,\n\ttypeof BBCodeElementNode,\n\ttypeof BBCodeRootNode,\n\ttypeof BBCodeTextNode,\n} from 'ui.bbcode.model';\nimport { type FormatterData, typeof Formatter, type FormatterElement } from './formatter';\n\nexport type ConvertCallbackOptions = {\n\tnode: BBCodeElementNode | BBCodeRootNode | BBCodeTextNode,\n\tformatter: Formatter,\n\tdata: FormatterData,\n};\n\nexport type ValidateCallbackOptions = ConvertCallbackOptions & {};\nexport type BeforeConvertCallbackOptions = ConvertCallbackOptions & {};\nexport type ForChildCallbackOptions = ConvertCallbackOptions & {\n\telement: FormatterElement,\n};\nexport type AfterCallbackOptions = ForChildCallbackOptions & {};\nexport type FormatterCallbackResult = Object | null;\n\nexport type NodeFormatterOptions = {\n\tname: string | Array<string>,\n\tconvert: (ConvertCallbackOptions) => FormatterCallbackResult,\n\tvalidate?: (ValidateCallbackOptions) => boolean,\n\tbefore?: (BeforeConvertCallbackOptions) => BBCodeNode | null,\n\tafter?: (AfterCallbackOptions) => FormatterCallbackResult,\n\tforChild?: (ForChildCallbackOptions) => FormatterCallbackResult,\n};\n\ntype DefaultNodeConverterOptions = ConvertCallbackOptions | BeforeConvertCallbackOptions;\ntype DefaultElementConverterOptions = ForChildCallbackOptions | AfterCallbackOptions;\n\nconst nameSymbol: Symbol = Symbol('name');\nconst groupSymbol: Symbol = Symbol('group');\nconst validateSymbol: Symbol = Symbol('validate');\nconst beforeSymbol: Symbol = Symbol('before');\nconst convertSymbol: Symbol = Symbol('convert');\nconst forChildSymbol: Symbol = Symbol('forChild');\nconst afterSymbol: Symbol = Symbol('after');\n\nconst defaultValidator = () => true;\nconst defaultNodeConverter = ({ node }: DefaultNodeConverterOptions) => node;\nconst defaultElementConverter = ({ element }: DefaultElementConverterOptions) => element;\n\nexport class NodeFormatter\n{\n\t[nameSymbol]: string = 'unknown';\n\t[groupSymbol]: ?Array<string> = null;\n\t[validateSymbol]: (ValidateCallbackOptions) => boolean;\n\t[beforeSymbol]: (BeforeConvertCallbackOptions) => FormatterCallbackResult = null;\n\t[convertSymbol]: (ConvertCallbackOptions) => FormatterCallbackResult = null;\n\t[forChildSymbol]: (ForChildCallbackOptions) => FormatterCallbackResult = null;\n\t[afterSymbol]: (AfterCallbackOptions) => FormatterCallbackResult = null;\n\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tif (Type.isArray(options.name))\n\t\t{\n\t\t\tthis[groupSymbol] = [...options.name];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setName(options.name);\n\t\t}\n\n\t\tthis.setValidate(options.validate);\n\t\tthis.setBefore(options.before);\n\t\tthis.setConvert(options.convert);\n\t\tthis.setForChild(options.forChild);\n\t\tthis.setAfter(options.after);\n\t}\n\n\tsetName(name: string)\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\tthrow new TypeError('Name is not a string');\n\t\t}\n\n\t\tthis[nameSymbol] = name;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this[nameSymbol];\n\t}\n\n\tsetValidate(callback: (ValidateCallbackOptions) => boolean)\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tthis[validateSymbol] = callback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis[validateSymbol] = defaultValidator;\n\t\t}\n\t}\n\n\tvalidate(options: ValidateCallbackOptions): boolean\n\t{\n\t\tconst result: ?boolean = this[validateSymbol](options);\n\t\tif (Type.isBoolean(result))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new TypeError(`Validate callback for \"${this.getName()}\" returned not boolean`);\n\t}\n\n\tsetBefore(callback: (BeforeConvertCallbackOptions) => FormatterCallbackResult)\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tthis[beforeSymbol] = callback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis[beforeSymbol] = defaultNodeConverter;\n\t\t}\n\t}\n\n\trunBefore(options: BeforeConvertCallbackOptions): FormatterCallbackResult\n\t{\n\t\treturn this[beforeSymbol](options);\n\t}\n\n\tsetConvert(callback: (ConvertCallbackOptions) => FormatterCallbackResult)\n\t{\n\t\tif (!Type.isFunction(callback))\n\t\t{\n\t\t\tthrow new TypeError('Convert is not a function');\n\t\t}\n\n\t\tthis[convertSymbol] = callback;\n\t}\n\n\trunConvert(options: ConvertCallbackOptions): FormatterCallbackResult\n\t{\n\t\treturn this[convertSymbol](options);\n\t}\n\n\tsetForChild(callback: (ForChildCallbackOptions) => FormatterCallbackResult)\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tthis[forChildSymbol] = callback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis[forChildSymbol] = defaultElementConverter;\n\t\t}\n\t}\n\n\trunForChild(options: ForChildCallbackOptions): FormatterCallbackResult\n\t{\n\t\treturn this[forChildSymbol](options);\n\t}\n\n\tsetAfter(callback: (AfterCallbackOptions) => FormatterCallbackResult)\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tthis[afterSymbol] = callback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis[afterSymbol] = defaultElementConverter;\n\t\t}\n\t}\n\n\trunAfter(options: AfterCallbackOptions): FormatterCallbackResult\n\t{\n\t\treturn this[afterSymbol](options);\n\t}\n}\n","import { Type } from 'main.core';\nimport { BBCodeFragmentNode, BBCodeNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { BBCodeParser } from 'ui.bbcode.parser';\nimport { NodeFormatter, type BeforeConvertCallbackOptions } from './node-formatter';\n\nexport * from './node-formatter';\n\nexport type FormatterData = {\n\t[key: string]: any,\n};\n\nexport type UnknownNodeCallbackOptions = {\n\tnode: BBCodeNode,\n\tformatter: Formatter,\n\tdata: FormatterData,\n};\n\nexport type FormatterOptions = {\n\tformatters: Array<NodeFormatter>,\n\tonUnknown: (UnknownNodeCallbackOptions) => BBCodeNode | null,\n};\n\nexport type FormatterFormatOptions = {\n\tsource: BBCodeNode | string,\n\tdata?: FormatterData,\n};\n\nexport interface FormatterElement\n{\n\tappendChild(): void\n}\n\nconst formattersSymbol: Symbol = Symbol('formatters');\nconst onUnknownSymbol: Symbol = Symbol('onUnknown');\n\n/**\n * @memberOf BX.UI.BBCode\n */\nexport class Formatter\n{\n\t[formattersSymbol]: Map<any, any> = new Map();\n\t[onUnknownSymbol]: (UnknownNodeCallbackOptions) => NodeFormatter | null = null;\n\n\tconstructor(options: FormatterOptions = {})\n\t{\n\t\tthis.setNodeFormatters(options.formatters);\n\t\tif (Type.isNil(options.onUnknown))\n\t\t{\n\t\t\tthis.setOnUnknown(this.getDefaultUnknownNodeCallback());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setOnUnknown(options.onUnknown);\n\t\t}\n\t}\n\n\tstatic isElement(source): boolean\n\t{\n\t\treturn Type.isObject(source) && Type.isFunction(source.appendChild);\n\t}\n\n\tstatic prepareSourceNode(source: BBCodeNode | string): BBCodeNode | null\n\t{\n\t\tif (source instanceof BBCodeNode)\n\t\t{\n\t\t\treturn source;\n\t\t}\n\n\t\tif (Type.isString(source))\n\t\t{\n\t\t\treturn (new BBCodeParser()).parse(source);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsetNodeFormatters(formatters: Array<NodeFormatter>)\n\t{\n\t\tif (Type.isArrayFilled(formatters))\n\t\t{\n\t\t\tformatters.forEach((formatter: NodeFormatter) => {\n\t\t\t\tthis.setNodeFormatter(formatter);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetNodeFormatter(formatter: NodeFormatter)\n\t{\n\t\tif (formatter instanceof NodeFormatter)\n\t\t{\n\t\t\tthis[formattersSymbol].set(formatter.getName(), formatter);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError('formatter is not a NodeFormatter instance.');\n\t\t}\n\t}\n\n\tgetDefaultUnknownNodeCallback(): (UnknownNodeCallbackOptions) => NodeFormatter | null\n\t{\n\t\tthrow new TypeError('Must be implemented in subclass');\n\t}\n\n\tsetOnUnknown(callback: (UnknownNodeCallbackOptions) => NodeFormatter | null)\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tthis[onUnknownSymbol] = callback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError('OnUnknown callback is not a function.');\n\t\t}\n\t}\n\n\trunOnUnknown(options: UnknownNodeCallbackOptions): NodeFormatter | null\n\t{\n\t\tconst result: NodeFormatter | null = this[onUnknownSymbol](options);\n\t\tif (result instanceof NodeFormatter || Type.isNull(result))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new TypeError('OnUnknown callback returned not NodeFormatter instance or null.');\n\t}\n\n\tgetNodeFormatter(node: BBCodeNode): NodeFormatter | null\n\t{\n\t\tconst formatter: ?NodeFormatter = this[formattersSymbol].get(node.getName());\n\t\tif (formatter instanceof NodeFormatter)\n\t\t{\n\t\t\treturn formatter;\n\t\t}\n\n\t\treturn this.runOnUnknown({ node, formatter: this });\n\t}\n\n\tformat(options: FormatterFormatOptions): DocumentFragment | HTMLElement | Text | null\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthrow new TypeError('options is not a object');\n\t\t}\n\n\t\tconst { source, data = {} } = options;\n\t\tif (!Type.isUndefined(data) && !Type.isPlainObject(data))\n\t\t{\n\t\t\tthrow new TypeError('options.data is not a object');\n\t\t}\n\n\t\tconst sourceNode: ?BBCodeNode = Formatter.prepareSourceNode(source);\n\t\tif (Type.isNull(sourceNode))\n\t\t{\n\t\t\tthrow new TypeError('options.source is not a BBCodeNode or string');\n\t\t}\n\n\t\tconst nodeFormatter: NodeFormatter = this.getNodeFormatter(sourceNode);\n\t\tconst isValidNode: boolean = nodeFormatter.validate({\n\t\t\tnode: sourceNode,\n\t\t\tformatter: this,\n\t\t\tdata,\n\t\t});\n\t\tif (!isValidNode)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst preparedNode: ?BBCodeNode = nodeFormatter.runBefore({\n\t\t\tnode: sourceNode,\n\t\t\tformatter: this,\n\t\t\tdata,\n\t\t});\n\t\tif (Type.isNull(preparedNode))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst convertedElement: ?HTMLElement = nodeFormatter.runConvert({\n\t\t\tnode: preparedNode,\n\t\t\tformatter: this,\n\t\t\tdata,\n\t\t});\n\t\tif (Type.isNull(convertedElement))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tpreparedNode.getChildren().forEach((childNode: BBCodeNode) => {\n\t\t\tconst childElement: ?HTMLElement = this.format({ source: childNode, data });\n\t\t\tif (Formatter.isElement(childElement))\n\t\t\t{\n\t\t\t\tconst convertedChildElement: ?HTMLElement = nodeFormatter.runForChild({\n\t\t\t\t\tnode: childNode,\n\t\t\t\t\telement: childElement,\n\t\t\t\t\tformatter: this,\n\t\t\t\t\tdata,\n\t\t\t\t});\n\t\t\t\tif (Formatter.isElement(convertedChildElement))\n\t\t\t\t{\n\t\t\t\t\tconvertedElement.appendChild(convertedChildElement);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn nodeFormatter.runAfter({\n\t\t\tnode: preparedNode,\n\t\t\telement: convertedElement,\n\t\t\tformatter: this,\n\t\t\tdata,\n\t\t});\n\t}\n}\n"],"names":["nameSymbol","Symbol","groupSymbol","validateSymbol","beforeSymbol","convertSymbol","forChildSymbol","afterSymbol","defaultValidator","defaultNodeConverter","node","defaultElementConverter","element","NodeFormatter","constructor","options","Type","isArray","name","setName","setValidate","validate","setBefore","before","setConvert","convert","setForChild","forChild","setAfter","after","isStringFilled","TypeError","getName","callback","isFunction","result","isBoolean","runBefore","runConvert","runForChild","runAfter","formattersSymbol","onUnknownSymbol","Formatter","Map","setNodeFormatters","formatters","isNil","onUnknown","setOnUnknown","getDefaultUnknownNodeCallback","isElement","source","isObject","appendChild","prepareSourceNode","BBCodeNode","isString","BBCodeParser","parse","isArrayFilled","forEach","formatter","setNodeFormatter","set","runOnUnknown","isNull","getNodeFormatter","get","format","isPlainObject","data","isUndefined","sourceNode","nodeFormatter","isValidNode","preparedNode","convertedElement","getChildren","childNode","childElement","convertedChildElement"],"mappings":";;;;;;CAmCA,MAAMA,UAAkB,GAAGC,MAAM,CAAC,MAAM,CAAC;CACzC,MAAMC,WAAmB,GAAGD,MAAM,CAAC,OAAO,CAAC;CAC3C,MAAME,cAAsB,GAAGF,MAAM,CAAC,UAAU,CAAC;CACjD,MAAMG,YAAoB,GAAGH,MAAM,CAAC,QAAQ,CAAC;CAC7C,MAAMI,aAAqB,GAAGJ,MAAM,CAAC,SAAS,CAAC;CAC/C,MAAMK,cAAsB,GAAGL,MAAM,CAAC,UAAU,CAAC;CACjD,MAAMM,WAAmB,GAAGN,MAAM,CAAC,OAAO,CAAC;CAE3C,MAAMO,gBAAgB,GAAG,MAAM,IAAI;CACnC,MAAMC,oBAAoB,GAAG,CAAC;GAAEC;CAAkC,CAAC,KAAKA,IAAI;CAC5E,MAAMC,uBAAuB,GAAG,CAAC;GAAEC;CAAwC,CAAC,KAAKA,OAAO;AAExF,CAAO,MAAMC,aAAa,CAC1B;GASCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KAAA,KATCf,UAAU,IAAY,SAAS;KAAA,KAC/BE,WAAW,IAAoB,IAAI;KAAA,KAEnCE,YAAY,IAA+D,IAAI;KAAA,KAC/EC,aAAa,IAAyD,IAAI;KAAA,KAC1EC,cAAc,IAA0D,IAAI;KAAA,KAC5EC,WAAW,IAAuD,IAAI;KAItE,IAAIS,cAAI,CAACC,OAAO,CAACF,OAAO,CAACG,IAAI,CAAC,EAC9B;OACC,IAAI,CAAChB,WAAW,CAAC,GAAG,CAAC,GAAGa,OAAO,CAACG,IAAI,CAAC;MACrC,MAED;OACC,IAAI,CAACC,OAAO,CAACJ,OAAO,CAACG,IAAI,CAAC;;KAG3B,IAAI,CAACE,WAAW,CAACL,OAAO,CAACM,QAAQ,CAAC;KAClC,IAAI,CAACC,SAAS,CAACP,OAAO,CAACQ,MAAM,CAAC;KAC9B,IAAI,CAACC,UAAU,CAACT,OAAO,CAACU,OAAO,CAAC;KAChC,IAAI,CAACC,WAAW,CAACX,OAAO,CAACY,QAAQ,CAAC;KAClC,IAAI,CAACC,QAAQ,CAACb,OAAO,CAACc,KAAK,CAAC;;GAG7BV,OAAO,CAACD,IAAY,EACpB;KACC,IAAI,CAACF,cAAI,CAACc,cAAc,CAACZ,IAAI,CAAC,EAC9B;OACC,MAAM,IAAIa,SAAS,CAAC,sBAAsB,CAAC;;KAG5C,IAAI,CAAC/B,UAAU,CAAC,GAAGkB,IAAI;;GAGxBc,OAAO,GACP;KACC,OAAO,IAAI,CAAChC,UAAU,CAAC;;GAGxBoB,WAAW,CAACa,QAA8C,EAC1D;KACC,IAAIjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC7B;OACC,IAAI,CAAC9B,cAAc,CAAC,GAAG8B,QAAQ;MAC/B,MAED;OACC,IAAI,CAAC9B,cAAc,CAAC,GAAGK,gBAAgB;;;GAIzCa,QAAQ,CAACN,OAAgC,EACzC;KACC,MAAMoB,MAAgB,GAAG,IAAI,CAAChC,cAAc,CAAC,CAACY,OAAO,CAAC;KACtD,IAAIC,cAAI,CAACoB,SAAS,CAACD,MAAM,CAAC,EAC1B;OACC,OAAOA,MAAM;;KAGd,MAAM,IAAIJ,SAAS,CAAE,0BAAyB,IAAI,CAACC,OAAO,EAAG,wBAAuB,CAAC;;GAGtFV,SAAS,CAACW,QAAmE,EAC7E;KACC,IAAIjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC7B;OACC,IAAI,CAAC7B,YAAY,CAAC,GAAG6B,QAAQ;MAC7B,MAED;OACC,IAAI,CAAC7B,YAAY,CAAC,GAAGK,oBAAoB;;;GAI3C4B,SAAS,CAACtB,OAAqC,EAC/C;KACC,OAAO,IAAI,CAACX,YAAY,CAAC,CAACW,OAAO,CAAC;;GAGnCS,UAAU,CAACS,QAA6D,EACxE;KACC,IAAI,CAACjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC9B;OACC,MAAM,IAAIF,SAAS,CAAC,2BAA2B,CAAC;;KAGjD,IAAI,CAAC1B,aAAa,CAAC,GAAG4B,QAAQ;;GAG/BK,UAAU,CAACvB,OAA+B,EAC1C;KACC,OAAO,IAAI,CAACV,aAAa,CAAC,CAACU,OAAO,CAAC;;GAGpCW,WAAW,CAACO,QAA8D,EAC1E;KACC,IAAIjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC7B;OACC,IAAI,CAAC3B,cAAc,CAAC,GAAG2B,QAAQ;MAC/B,MAED;OACC,IAAI,CAAC3B,cAAc,CAAC,GAAGK,uBAAuB;;;GAIhD4B,WAAW,CAACxB,OAAgC,EAC5C;KACC,OAAO,IAAI,CAACT,cAAc,CAAC,CAACS,OAAO,CAAC;;GAGrCa,QAAQ,CAACK,QAA2D,EACpE;KACC,IAAIjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC7B;OACC,IAAI,CAAC1B,WAAW,CAAC,GAAG0B,QAAQ;MAC5B,MAED;OACC,IAAI,CAAC1B,WAAW,CAAC,GAAGI,uBAAuB;;;GAI7C6B,QAAQ,CAACzB,OAA6B,EACtC;KACC,OAAO,IAAI,CAACR,WAAW,CAAC,CAACQ,OAAO,CAAC;;CAEnC;;CClJA,MAAM0B,gBAAwB,GAAGxC,MAAM,CAAC,YAAY,CAAC;CACrD,MAAMyC,eAAuB,GAAGzC,MAAM,CAAC,WAAW,CAAC;;CAEnD;CACA;CACA;AACA,CAAO,MAAM0C,SAAS,CACtB;GAIC7B,WAAW,CAACC,OAAyB,GAAG,EAAE,EAC1C;KAAA,KAJC0B,gBAAgB,IAAmB,IAAIG,GAAG,EAAE;KAAA,KAC5CF,eAAe,IAA0D,IAAI;KAI7E,IAAI,CAACG,iBAAiB,CAAC9B,OAAO,CAAC+B,UAAU,CAAC;KAC1C,IAAI9B,cAAI,CAAC+B,KAAK,CAAChC,OAAO,CAACiC,SAAS,CAAC,EACjC;OACC,IAAI,CAACC,YAAY,CAAC,IAAI,CAACC,6BAA6B,EAAE,CAAC;MACvD,MAED;OACC,IAAI,CAACD,YAAY,CAAClC,OAAO,CAACiC,SAAS,CAAC;;;GAItC,OAAOG,SAAS,CAACC,MAAM,EACvB;KACC,OAAOpC,cAAI,CAACqC,QAAQ,CAACD,MAAM,CAAC,IAAIpC,cAAI,CAACkB,UAAU,CAACkB,MAAM,CAACE,WAAW,CAAC;;GAGpE,OAAOC,iBAAiB,CAACH,MAA2B,EACpD;KACC,IAAIA,MAAM,YAAYI,0BAAU,EAChC;OACC,OAAOJ,MAAM;;KAGd,IAAIpC,cAAI,CAACyC,QAAQ,CAACL,MAAM,CAAC,EACzB;OACC,OAAQ,IAAIM,6BAAY,EAAE,CAAEC,KAAK,CAACP,MAAM,CAAC;;KAG1C,OAAO,IAAI;;GAGZP,iBAAiB,CAACC,UAAgC,EAClD;KACC,IAAI9B,cAAI,CAAC4C,aAAa,CAACd,UAAU,CAAC,EAClC;OACCA,UAAU,CAACe,OAAO,CAAEC,SAAwB,IAAK;SAChD,IAAI,CAACC,gBAAgB,CAACD,SAAS,CAAC;QAChC,CAAC;;;GAIJC,gBAAgB,CAACD,SAAwB,EACzC;KACC,IAAIA,SAAS,YAAYjD,aAAa,EACtC;OACC,IAAI,CAAC4B,gBAAgB,CAAC,CAACuB,GAAG,CAACF,SAAS,CAAC9B,OAAO,EAAE,EAAE8B,SAAS,CAAC;MAC1D,MAED;OACC,MAAM,IAAI/B,SAAS,CAAC,4CAA4C,CAAC;;;GAInEmB,6BAA6B,GAC7B;KACC,MAAM,IAAInB,SAAS,CAAC,iCAAiC,CAAC;;GAGvDkB,YAAY,CAAChB,QAA8D,EAC3E;KACC,IAAIjB,cAAI,CAACkB,UAAU,CAACD,QAAQ,CAAC,EAC7B;OACC,IAAI,CAACS,eAAe,CAAC,GAAGT,QAAQ;MAChC,MAED;OACC,MAAM,IAAIF,SAAS,CAAC,uCAAuC,CAAC;;;GAI9DkC,YAAY,CAAClD,OAAmC,EAChD;KACC,MAAMoB,MAA4B,GAAG,IAAI,CAACO,eAAe,CAAC,CAAC3B,OAAO,CAAC;KACnE,IAAIoB,MAAM,YAAYtB,aAAa,IAAIG,cAAI,CAACkD,MAAM,CAAC/B,MAAM,CAAC,EAC1D;OACC,OAAOA,MAAM;;KAGd,MAAM,IAAIJ,SAAS,CAAC,iEAAiE,CAAC;;GAGvFoC,gBAAgB,CAACzD,IAAgB,EACjC;KACC,MAAMoD,SAAyB,GAAG,IAAI,CAACrB,gBAAgB,CAAC,CAAC2B,GAAG,CAAC1D,IAAI,CAACsB,OAAO,EAAE,CAAC;KAC5E,IAAI8B,SAAS,YAAYjD,aAAa,EACtC;OACC,OAAOiD,SAAS;;KAGjB,OAAO,IAAI,CAACG,YAAY,CAAC;OAAEvD,IAAI;OAAEoD,SAAS,EAAE;MAAM,CAAC;;GAGpDO,MAAM,CAACtD,OAA+B,EACtC;KACC,IAAI,CAACC,cAAI,CAACsD,aAAa,CAACvD,OAAO,CAAC,EAChC;OACC,MAAM,IAAIgB,SAAS,CAAC,yBAAyB,CAAC;;KAG/C,MAAM;OAAEqB,MAAM;OAAEmB,IAAI,GAAG;MAAI,GAAGxD,OAAO;KACrC,IAAI,CAACC,cAAI,CAACwD,WAAW,CAACD,IAAI,CAAC,IAAI,CAACvD,cAAI,CAACsD,aAAa,CAACC,IAAI,CAAC,EACxD;OACC,MAAM,IAAIxC,SAAS,CAAC,8BAA8B,CAAC;;KAGpD,MAAM0C,UAAuB,GAAG9B,SAAS,CAACY,iBAAiB,CAACH,MAAM,CAAC;KACnE,IAAIpC,cAAI,CAACkD,MAAM,CAACO,UAAU,CAAC,EAC3B;OACC,MAAM,IAAI1C,SAAS,CAAC,8CAA8C,CAAC;;KAGpE,MAAM2C,aAA4B,GAAG,IAAI,CAACP,gBAAgB,CAACM,UAAU,CAAC;KACtE,MAAME,WAAoB,GAAGD,aAAa,CAACrD,QAAQ,CAAC;OACnDX,IAAI,EAAE+D,UAAU;OAChBX,SAAS,EAAE,IAAI;OACfS;MACA,CAAC;KACF,IAAI,CAACI,WAAW,EAChB;OACC,OAAO,IAAI;;KAGZ,MAAMC,YAAyB,GAAGF,aAAa,CAACrC,SAAS,CAAC;OACzD3B,IAAI,EAAE+D,UAAU;OAChBX,SAAS,EAAE,IAAI;OACfS;MACA,CAAC;KACF,IAAIvD,cAAI,CAACkD,MAAM,CAACU,YAAY,CAAC,EAC7B;OACC,OAAO,IAAI;;KAGZ,MAAMC,gBAA8B,GAAGH,aAAa,CAACpC,UAAU,CAAC;OAC/D5B,IAAI,EAAEkE,YAAY;OAClBd,SAAS,EAAE,IAAI;OACfS;MACA,CAAC;KACF,IAAIvD,cAAI,CAACkD,MAAM,CAACW,gBAAgB,CAAC,EACjC;OACC,OAAO,IAAI;;KAGZD,YAAY,CAACE,WAAW,EAAE,CAACjB,OAAO,CAAEkB,SAAqB,IAAK;OAC7D,MAAMC,YAA0B,GAAG,IAAI,CAACX,MAAM,CAAC;SAAEjB,MAAM,EAAE2B,SAAS;SAAER;QAAM,CAAC;OAC3E,IAAI5B,SAAS,CAACQ,SAAS,CAAC6B,YAAY,CAAC,EACrC;SACC,MAAMC,qBAAmC,GAAGP,aAAa,CAACnC,WAAW,CAAC;WACrE7B,IAAI,EAAEqE,SAAS;WACfnE,OAAO,EAAEoE,YAAY;WACrBlB,SAAS,EAAE,IAAI;WACfS;UACA,CAAC;SACF,IAAI5B,SAAS,CAACQ,SAAS,CAAC8B,qBAAqB,CAAC,EAC9C;WACCJ,gBAAgB,CAACvB,WAAW,CAAC2B,qBAAqB,CAAC;;;MAGrD,CAAC;KAEF,OAAOP,aAAa,CAAClC,QAAQ,CAAC;OAC7B9B,IAAI,EAAEkE,YAAY;OAClBhE,OAAO,EAAEiE,gBAAgB;OACzBf,SAAS,EAAE,IAAI;OACfS;MACA,CAAC;;CAEJ;;;;;;;;;"}